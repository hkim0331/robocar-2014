<!DOCTYPE html>
<!--
# VERSION: 0.6
-->
<html lang="ja">
<head>
<meta charset="utf-8" />
<link rel="stylesheet" href="stylesheets/screen.css" />
<title>robocar 2014</title>
<style>
</style>
</head>
<body>
<header>
情報処理応用 ー Robocar Programming
</header>
<h2>Motor0</h2>

<p>今日のプロジェクトは Import project(s) から、
<span class='red'>Motor0</span>
(モーターゼロ、括弧内は読み方であり、プロジェクト名の一部じゃないよ)
です。
間違えないように。</p>

<h3>Mtr_Run_lv( )</h3>

<ul>
  <li>関数 Mtr_Run_lv( )はモータを制御する。</li>

  <li>ロボカーにはモータを６つつけることが可能であるため、
    関数 Mtr_Run_lv( ) もそれぞれをコントロールできるよう、
    ６つの引数(ひきすうと読む)を取るようにプログラムしてある。

    <p>LPCxpresso で src/vs-wrc103.c を開き、
      関数 Mtr_Run_lv が定義してある箇所を探せ。<p></li>

  <li>みんなのロボカーに搭載のモーターは二個。
    Mtr_Run_lv の引数６つのうち、最初の二つしか意味がない。</li>

  <li>意味がないとは言っても、Mtr_Run_Lv 関数を呼び出すときは定義に従い
    ６つの short 型変数を引数に与えなければならない。

<pre class="c">
// これはよくないプログラムの例だぞ。
<span class='red'>
void run(void) {
	Mtr_Run_lv(10000,0,0,0,0,0);
	Wait(3000);
	Mtr_Run_lv(0,0,0,0,0,0);
}
</span>
int main(void) {
	const unsigned short MainCycle = 60;
	Init(MainCycle);
<span class='red'>
	run();
</span>
	return 0;
}
</pre></li>

  <li>上のプログラムをロボカーに焼き、ロボカーの動きを観察しなさい。
    Mtr_Run_lv(10000,0,0,0,0,0)の意味を推測しなさい。</li>
  <li>プログラムを改良し、ロボカーを前進させなさい。</li>
  <li>書いたプログラムを、読みやすく、変更しやすいプログラムに改良しなさい。</li
  <li>Mtr_Run_lv( )は６つの引数を取り、すべての引数の型は short。</li>
</ul>

<h3>short 型</h3>

<p>「16ビット、符号付き整数」でわかる人は演習を続けよう。</p>

<h3>int 型</h3>

<p>short の前に基本の int を理解する。</p>

<p>int x;  の宣言の省略しない書き方は signed int x;

<pre class="c">
signed int x; // int x; としても同じ。
</pre>

<p>32bit のメモリ領域を確保し、その場所を名前 x で参照する。</p>

<table>
<tr>
<td>x
<td><table class="tabular">
<tr>
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
<td>1/0
</tr>
</table>
</tr>
</table>

<ul>
<li>それぞれのマスには 1 か 0 のデータが入る。
1、0 以外のデータは入りきらない。</li>

<li>マスの数は 32 個。</li>

<li>この x は何通りのパターンがあるか?
(答え 2<sup>32</sup>通り)</li>

<li>それぞれのパターンをどう解釈するかを決めよう。なるだけ自然に。</li>

<table class="tabular">
<tr>
<th>番号</th>
<th>ビットパターン</th>
<th>unsigned int</th>
<th>signed int</th>
<tr>
<td>1
<td>00000000 00000000 00000000 00000000
<td>0
<td>0
</tr>
<tr>
<td>2
<td>00000000 00000000 00000000 00000001
<td>1
<td>1
</tr>
<tr>
<td>3
<td>00000000 00000000 00000000 00000010
<td>2
<td>2
</tr>

<tr>
<td colspan="4">...
</tr>

<tr>
<td>2<sup>31</sup>-1
<td>01111111 11111111 11111111 11111111
<td>2,147,483,647(2<sup>31</sup>-1)
<td>2,147,483,647(2<sup>31</sup>-1)
</tr>

<tr>
<td>2<sup>31</sup>
<td>10000000 00000000 00000000 00000000
<td>2,147,483,648(2<sup>31</sup>)
<td>-2,147,483,648(-2<sup>31</sup>)
</tr>

<tr>
<td colspan="4">...
</tr>

<tr>
<td>2<sup>32</sup>-1
<td>11111111 11111111 11111111 11111110
<td>4,294,967,294
<td>-2
</tr>

<tr>
<td>2<sup>32</sup>
<td>11111111 11111111 11111111 11111111
<td>4,294,967,295 (2<sup>32</sup>-1)
<td>-1
</tr>
</table>

<p>32ビットのメモリで整数を表現するとき、C では二通りのビットパターン解釈を用意している。
ひとつは unsigned int でパターン全部で正の整数を表す。
もうひとつは signed int でパターンの半分を正の数、残り半分を負の数を表すパターンとする。みんなが何気なく定義している int x; などは singed int x; の singed が省略されたもの(Ｃでは singed/unsigned を省略すると singed が省略されたとする決まりがある)。
</li>
</ul>

<h3>Mtr_Run_lv(short m1, short m2,...)</h3>

<p>便宜上、メモリを縦長の四角で表す。</p>

<p><img src="images/signed_unsigned.png" style="width:600px;"></p>

<p>int, short, char は確保するメモリ領域のがどのくらいの大きさなのかを決め、
signed やunsigned はその確保されたメモリ領域内の 1/0 のパターンの解釈の仕方を決めている(さらに言えば、double や float、char なども同じ)。</p>

<p>関数 Mtr_Run_lv の定義(src/vs-wrc103.cに見つかる)は、</p>

<pre class="c">
void Mtr_Run_lv(short m1, short m2, short m3, short m4, short m5, short m6)
{
  ...
}
</pre>

<p>m1,m2,m3,m4,m5,m6 にはそれぞれ16 ビット符号付き整数で、
その範囲は -2<sup>15</sup>~2<sup>15</sup>-1。
その範囲外の数字を Mtr_Run_lv( )に与えても、メモリが溢れてしまい、
結果としてロボカーは期待する動きをしない。</p>

<p>2<sup>15</sup>はいくらか。それくらい自分で計算しなさい。</p>

<h3>Mtr_Run_lv( )を生で使うな!</h3>

<ul>

<li>ロボカーには二つしかモーターが付いてないのに、
いちいち、
Mtr_Run_lv(10000,-10000,0,0,0,0) とタイプするのはめんどうじゃないか?</li>

<li>Mtr_Run_lv( )の連打はプログラムが読みにくくならないか。
キラキラ星を思い出せ。</li>

<li>「Mtr_Run_lv(10000,-10000,0,0,0,0) が前進で、
Mtr_Run_lv(10000,-10000,0,0,0,0) は後退で、...」
と読み替えるのはめんどうくさくないか。
</ul>

<p>もっと相応しい名前の関数で Mtr_Run_lv( ) をラップしよう。
例えば foward(10)で 10cm 前進、
backward(30)で 30cm 後退になるようにプログラムしよう。</p>

<p>右回り関数や左回り関数も同様にプログラムしておこう。</p>

<h4>提出問題</h4>

<p>授業で学んだことを前提に、以下の問いに取り組みなさい。
<span class="red">5. はグループ課題</span>。
授業の内容を反映していない、出すだけの回答は激しくマイナス。
出さないほうがマシ。グループの力を結集し、よく練った回答を
<a href="/exercises/new">提出</a>
すること。
</p>

<ol>
  <li>ロボカーを 10cm 前進させるプログラム。</li>
  <li>ロボカーを 50cm 後退させるプログラム。</li>
  <li>ロボカーを 30度、左回りに回転させるプログラム。</li>
  <li>ロボカーを 360度、右回りに回転させるプログラム。</li>
  <li class="red">ロボカーを１辺が 40cm の正方形を描くよう動かすプログラム。
    元の位置に戻ったあと、一芸(ダンスを踊るとか、
    ファンファーレを鳴らすとか)するとプログラムの終了がわかってよい。
  </li>
</ol>

<p><a href="index.html">back</a></p>
<footer>
Last update: <script>document.write(document.lastModified);</script>
</footer>
</body>
</html>
