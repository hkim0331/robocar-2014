## Step by Step!

今日のプロジェクトは step。内容は、

* Windows で焼けるぞ。その方法は？
* 関数
* 繰り返し
* 条件分岐

## 関数 unsigned short ADRead(unsinged char n)

関数 ADRead() はロボカーの目になる。

### 問題 1

1. これまで、ロボカーを動かす（鳴らす）関数はいくつ習ったか？すべてあげよ。
2. unsigned short の意味は？
3. unsigned char の意味は?

関数 ADRead()は unsigned char 型の引数nを受け取り、
unsigned short 型の戻り値を返す。

ただし、n は

* 0 のとき、どちらかのフォトセンサを表す。
* 1 のとき、上とは別のフォトセンサを表す。
* それ以外の時、意味なし。

ADRead( )の戻り値は unsigned short で表現できる範囲のうち、
0~1023 しか意味を持たず（それ以外の値は返ってこない）、

* 0 に近い時は、指定したフォトセンサの読み出しが白に近いことを示す。
* 1023 に近い時は、指定したフォトセンサの読み出しが黒に近いことを示す。

### 問題 2

1. ロボカーを上から見て、
「右目で読む床面の明るさはいくつか？」の意味になるプログラム。
2. ロボカーを上から見て、
「左目で読む床面の明るさはいくつか？」の意味になるプログラム。
3. ロボカーを上から見て、「左目が黒を見ている」と判断するプログラム。

## 繰り返し

C で繰り返しは for, あるいは while で書く。もう一丁あるが、忘れてよい。

````c
for (ループに入る前; ループを続ける条件; ループが一周終わったら)
{
	ループの本体;
}
````

````c
while (ループを続ける条件)
{
	ループの本体;
}
````

ループの本体を { } で囲むことを忘れずに。

### break, continue

* ループ中で break はループを脱出する。
* ループ中で continue はループの先頭に戻る。

## 条件分岐

基本は if ~ else ~ 。プログラム初心者は else を書くように心がけよう。
else で実行することがなければ空振りのセミコロンを書いておく。

````c
if (条件)
{
	条件が真のときに実行する;
}
else
{
	条件が偽のときに実行する;
}
````

この字下げはムダが多く、else で始まる文はありえないし、
hkimura は苦手です。
次のスタイルが好み。

````c
if (条件) {
	条件が真のときに実行する;
} else {
	条件が偽のときに実行する;
}
````
かっこ { } の対応がきちんとしてればどうでもよい。
しかし、
<span style='color:red;'>
自分のスタイルを決めたらそのスタイルで統一し一貫してプログラム書くこと。
</span>

### 何が真で、何が偽か？

Cの世界では、

* 0 が偽。
* 0 以外はすべて真。

Cになったつもりで、次の真偽を答えよ。(int x=5; が定義されているとする。)

1. 3 > 1
1. 3 > 5
1. 3 == 3
1. 3 != 3
1. 10
1. 0
1. x == 5
1. x == 4
1. x = 10
1. 1 < (x < 10)
1. (1 < x) < 10

### 問題

int x=3 のとき、次の int y に代入される値はいくつか？

````c
y = (1 < x) + (2< x) + (3 < x) + (4 < x);
````

## 個人課題

1. 関数 step() を定義せよ。step() はロボカーを 5mm 進めて、止める。
1. そのあと、
関数 main を以下のようにプログラムし、ロボカーが3cm進むことを確認せよ。

````c
//これはいいプログラの見本ではない。
int main(void)
{
	const unsigned short MainCycle = 60;
	Init(MainCycle);

	step();
	Wait(500);
	step();
	Wait(500);
	step();
	Wait(500);
	step();
	Wait(500);
	step();
	Wait(500);
	step();
	Wait(500);

    return 0;
}
````

### for で書き直し

「step(); Wait(500); を6回繰り返す」を for で書く。

````c
//部分のみ
int i; // 変数iでループを回った回数を数えたい。使う前に宣言。

for (i=0; i<6; i++) { // この書き方を覚えよ。
	step();
	Wait(500);
}
````

while で書き直す。同じ動作。

````c
int i=0; // 宣言すると同時に初期化してしまう。安全プログラム。

while (i<6) {
    step();
    Wait(500);
    i++; // ループを回った回数を数え上げる。
}
````

while ではループ内でi++するのを（私は）よく忘れる。
for で書くほうが誤って無限ループを作ってしまうことが少ない。

### 字下げ

きちんと字下げすると読みやすい。かっこの対応もつけやすい。

LPCXpresso だと、`Source` メニューの `Correct Indentation`。

## ループ内の仕事を増やす

今はループ内で二つの仕事（while では3つ）している。
ループを無限ループに、ループ内に仕事を二つ足し、

* 右目（左目）の直下の明るさを測定する。
* それを黒と認識できたらループを脱出する。

ループをでたらカエルの歌を鳴らす。

````c
//  改良1
int i;

	for(i=0; i< 10000; i++) {
		step();
		Wait(500);
        unsigned short left; // ADRead() の返す型の変数を用意して、
        left = ADRead(0);    // 代入により受け取る。
    }
    return 0;
}
````

プログラムのムダを省こう。

* 無限ループっつってるのに、ループの回数を数えるのはムダ。
* left はループの外で作れば一回で済む。

````c
//  改良2
    unsigned short left; // ADRead() の返す型の変数を用意して、

	for( ; ; ) {
		step();
		Wait(500);
        left = ADRead(0);    // 代入により受け取る。
    }
    return 0;
}
````

プログラムには「黒と認識」の部分がない。 変数left の値がいくつだと黒か？
よーく考えなさい。ここが今日のグループ課題です。

## グループ課題

50cm四方程度のスチレンボードを持っていけ。ロボカーをその上の白い部分に置き、
黒テープの位置まで 5mm ずつにじり寄る。黒踏んだら止まってカエルの歌を歌え。
==> [hkimura の解答例](step.html) 理解せずにコピーすんな！

----
written by hkimura.