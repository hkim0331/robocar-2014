## 前進 1cm!

今日のプロジェクトは motor。import project, rename project の例の手順で準備せよ。

テーマは char, int, short, unsigned, signed の意味を知る、だ。準備はいいか?

### Mtr_Run_lv()

motor プロジェクトの main.c を書き換える。

* 関数 Mtr_Run_lv() はロボカーのモーターを制御する。
* ロボカーには最大６個のモータを乗せることが可能であるため、
関数 Mtr_Run_lv() も６つのモーターを制御できるようなプログラムになっている。
* しかし、授業で使うロボカーに搭載のモーターは二つ。
* 関数 Mtr_Run_lv()は６つの引数を取り、それぞれ第一のモーター、第二のモーター、
... 第６のモータの出力を命令する。授業のロボカーで有効なのは最初の二つだけ。
あとの４つは単に無視される。

````c
// ロボカーを 5 秒前進させる。
// プログラム的にはあまり良くない。
// 先週の授業を思い出して改良せよ。
#include "LPC13xx.h"
#include "gpio.h"
#include "vs-wrc103.h"
#include "ixbus.h"

int main(void)
{
  const unsigned short MainCycle = 60;
  Init(MainCycle);

  Mtr_Run_lv(10000, -10000, 0, 0, 0, 0);
  Wait(5000);
  Mtr_Run_lv(0, 0, 0, 0, 0);	// エラー

  return 0;
}
````

### 演習１
1. Wait(5000)でロボカーが何cm進んだか、測定せよ。
1. ロボカーを 1cm 前進、静止させよ。
1. ロボカーを 10cm 前進、静止させよ。
<<<<<<< HEAD
1. ロボカーを 5cm 後退、静止させよ。
1. スイッチを入れてから ２ 秒後にロボカーが動作開始するようにせよ。

### 演習２
1. ロボカーを右に 90 度回転させ、静止。
1. ロボカーを左に 360 度回転させ、静止。
=======
1. ロボカーを 5cm 後退させよ。
1. スイッチ入れて２秒後にロボカーをスタートさせよ。

### 演習２
1. ロボカーを 90 度、右回転させよ。
1. ロボカーを 360 度、左回転させよ。
>>>>>>> hotfix/0.9.1

### 演習３
1. ロボカーを2倍の速度で10cm 前進、静止させよ。
1. ロボカーを1/2の速度で10cm 前進、静止させよ。

## Mtr_Run_lv() を調べる

関数 Mtr_Run_lv() はファイル vs-wrc103.c の 195 行目に定義されている。
その最初の行（シグナチャという）に注目。

````c
void Mtr_Run_lv(short m1, short m2, short m3, short m4, short m5, short m6)
````

このシグナチャは、

* 関数の戻り値は void
* 関数の名前は Mtr_Run_lv
* 関数の引き数は short 型の m1, m2, ... , m6 の６つ

であることを示す。

授業ではシグナチャ以外、関数 Mtr_Run_lv()のボディは深入りしない。
授業のレベルを超えて勉強したい学生はどんどん行け。
「short 型の m1」って意味がわかるか？が授業で求めるレベル。

### ビットを理解する

ビット(bit)は 0 か 1 か必ずどちらかの状態を取る。

### char, short, int, long

bit が表現できるパターンは二通り。

bit をまとめ、もっとたくさんのパターンを表せるようにする。
そして、そのパターンにどんな意味を持たせるかを合理的に決める。
何個のビットをひとまとめにするかにより、char、short、int、long の型になる。

ロボカーに搭載の CPU では

| 型|ビット長|表現できるデータの種類|unsigned|signed|
|:-:|:------:|:---------------:|:----:|:----:|
|char  |8bit |2<sup>8</sup>通り|0 ~ 2<sup>8</sup>-1  | -2<sup>7</sup> ~ 2<sup>7</sup>-1 |
|short |16bit|2<sup>16</sup>通り|0 ~ 2<sup>16</sup>-1||
|int   |32bit|2<sup>32</sup>通り|0 ~ 2<sup>32</sup>-1||
|long  |64bit|2<sup>64</sup>通り|0 ~ 2<sup>64</sup>-1||

#### 演習（小学生、中学生レベル）

* 2<sup>8</sup> はいくらか？ 2<sup>16</sup>, 2<sup>32</sup>, 2<sup>64</sup> は？
上表の空欄を埋めよ。

### (double, float)

小数点付きの数を保持するときに使う。
ロボカー授業では使わない。
さらに float は他の場所でも現在はほとんど使われない。

### unsigned, signed

bit パターンの解釈の方法を表す。

* unsigned (符号なし)は 0 をいちばん小さいデータとする。
一番大きい数はすべてのビットが１となった数。
* signed は 0 を中央のデータとする。
すべてのビットが１になった数は「１を足すと０」という性質から、-1 を表すと考える。
* signed/unsigned が省略された場合は signed が指定されたと考える。


<p><img src="images/signed-unsigned.png" style="width:70%;"></p>

### short m1

Mtr_Run_lv()の引き数 "short m1" は、書き方を省略しないとすれば "signed short m1"。
つまり、"符号付き 16 ビットの整数 m1"。その意味を理解できないとダメ。

"short m1" と宣言された変数 m1 が取りうる値の最小値、最大値はいくらか？

### 演習5
* Mtr_Run_lv(10000,-10000,0,0,0,0)　に比較し、
Mtr_Run_lv(40000,-40000,0,0,0,0)が
４倍速にならない理由を述べよ。


## 本日のグループ課題

一辺が 30cm の正方形の辺に沿ってロボカーを走らせろ。一周したら静止。
完成したらロボカーの演技を hkimura に見せ、そのプログラム main.c を送信しなさい。

[戻る](/)

----
written by hkimura.
