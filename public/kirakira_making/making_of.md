### Making of Kirakira

先週の授業では、

* グループを結成した。
* キラキラ星を演奏するプログラムを作った。
* プロジェクトのインポート、編集、ビルド、バイナリ転送、ロボカーの焼き付けを覚えた。
* ロボカーが理解する関数(BuzzerSet(), BuzzerStart(),...)を使えば楽勝だった。
* (マイカーとマイPCがあればもっと楽と理解した。)

____
### プログラムを改良する

みんなの作ったプログラムはだいたいこんな感じ。

    int main(void)
    {
      const unsigned short MainCycle = 60;
      Init(MainCycle);

      BuzzerSet(179, 100);
      BuzzerStart();
      Wait(400);
      BuzzerStop();
      Wait(100);
      ...
      ...
    }

[main.c](main1.html)
____

### どこを改良するか？

「動けばいい」はダメ。
もうちょっと課題が難しくなるとすぐに動かなくなる。

* main関数を短く。
* コピペをなるべく使わない。
* 関数を利用して、BuzzerSet()...Wait(3000)までのブロックをまとめる。

たとえばこんなのどうですか？ => [main2.c](main2.html)

____

### まだ改良する

関数使ったが、DO() や SO()の関数のボディはほとんど同じもの。
変更が必要になったら、関数の数だけ、変更する箇所があることは変わらない。

共通する部分をさらに関数でまとめる。

[main3.c](main3.html)

____

### さらに改良

キラキラ星の場合、一つ一つの音符のボリューム、音長さ、休み時間は同じ。

同じ長さは別のところにプログラムしておくと、
後で変更したくなっても、変更の箇所がプログラム中に散らばらず、作業が楽になる。

[main4.c](main4.html) を見よ。

----

### 完成と思ったところでさらに

DO(), RE(), MI() 関数はアイデアであったけど、さらにアイデアをしぼる。

DO, RE, MI を音のピッチを表す定数とし、楽曲を配列で表現する。

配列の最後に、「配列はここで終わり」を示すマークをつけておく。
そのマークをロボカーが読んだら演奏を終了する。

[main5.c](main5.html)

----

### もっとプログラム

ここまで来るとちょっと欲が出てくる。キラキラ星以外の楽曲も鳴らしたいぞ。

カエルの歌だ。しかし、カエルの歌にはキラキラ星には出てこなかった休止府もある。

ので、プログラムを変更。楽曲の終わりの他に休止符を理解するように改良する。

カエルの歌は関数 kaeru() で定義しよう。

[main6.c](main6.html)


----

### 趣味で

[main7.c](main7.html) の変更は軽微です。

関数 kirakira() と関数 kaeru() の中で、ともに for ループを呼んでいるのが
見苦しいと思われたので、それを関数 music() に変更。

----

### 短い音符も

カエルの歌には短い音符も出てきます。短い音符をどうプログラムするか、
方法はいろいろあると思いますが、
ここでは DURATION と PAUSE の長さを変えることにします。

受講生は別の方法でトライすること。

[main8.c](main8.html)







